<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org/"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<meta name="_csrf" th:content="${_csrf.token}" />
<meta name="_csrf_header" th:content="${_csrf.headerName}">
<title>दक्षिणकाली नगरपालिका</title>
<!--favicon-->
<link rel="icon" th:href="@{/assets/images/favicon1.ico}"
	href="assets/images/favicon1.ico" type="image/x-icon" />
<link th:href="@{/assets/plugins/vectormap/jquery-jvectormap-2.0.2.css}"
	href="assets/plugins/vectormap/jquery-jvectormap-2.0.2.css"
	rel="stylesheet" />
<link th:href="@{/assets/plugins/simplebar/css/simplebar.css}"
	href="assets/plugins/simplebar/css/simplebar.css" rel="stylesheet" />
<link th:href="@{/assets/css/bootstrap.min.css}"
	href="assets/css/bootstrap.min.css" rel="stylesheet" />
<link th:href="@{/assets/css/animate.css}" href="assets/css/animate.css"
	rel="stylesheet" type="text/css" />
<link th:href="@{/assets/css/icons.css}" href="assets/css/icons.css"
	rel="stylesheet" type="text/css" />
<link th:href="@{/assets/css/sidebar-menu.css}"
	href="assets/css/sidebar-menu.css" rel="stylesheet" />
<link th:href="@{/assets/css/app-style.css}"
	href="assets/css/app-style.css" rel="stylesheet" />
<link rel="stylesheet"
	th:href="@{/assets/plugins/nepali-datepicker/nepaliDatePicker.min.css}"
	href="assets/plugins/nepali-datepicker/nepaliDatePicker.min.css">
<link rel="stylesheet"
	th:href="@{/assets/plugins/datatable/datatables.min.css}"
	href="assets/plugins/datatable/datatables.min.css">
<link rel="stylesheet"
	th:href="@{/assets/plugins/jquery.steps/css/jquery.steps.css}"
	href="assets/plugins/jquery.steps/css/jquery.steps.css">
</head>
<style>
	button.nav_btn-top {
    color: white !important;
}
.nav_btn button {
    margin-right: 22px;
}
.header_ul .ui_input-field {
    height: 26px;
    width: 38%;
    padding: 0.375rem 0.75rem;
    font-size: 1rem;
    line-height: 1.5;
    color: #495057;
    background-color: #fff;
    background-clip: padding-box;
    border: 1px solid #ced4da;
    margin-left: 10px;
}
.table thead th {
    font-size: .9rem;

}
a.btn.btn-xs.btn-success {
    color: white;
}
.btn {
    font-size: .9rem;

}
label {

    font-size: 14px;

}
.btn-info {
    color: #fff;
    background-color: #03d0ea;
    border-color: #03d0ea;
    color: white !IMPORTANT;
}
</style>
<body>
	<div id="wrapper">
		<!-- Side bar and header -->
		<div sec:authorize="isAuthenticated()"
			th:replace="~{fragments/private-sidebar :: private-sidebar}"></div>
		<div sec:authorize="!isAuthenticated()"
			th:replace="~{fragments/public-sidebar :: public-sidebar}"></div>
		<header th:replace="~{fragments/header :: header}" class="header1">
		</header>
		<div th:fragment="buttonFragment"  id = "buttonFragment" style="display:none">
			<button class="btn btn-xs btn-success text-dark float-right" onclick="convertToExcel('myTable', 'report_favourite')"
					sec:authorize="hasAnyRole('CENTRAL_ADMIN', 'WARD_ADMIN', 'SURVEYOR')">डाउनलोड Csv</button>
		</div>
		<div class="clearfix"></div>
		<div class="content-wrapper">
			<div class="container-fluid" id="pjax-container">
				<div class="row pt-2 pb-2">
					<div class="col-sm-9">
						<h4 class="page-title">नगरबासी बिवरण कम्प्युटर प्रणाली</h4>
						<ol class="breadcrumb">
							<li class="breadcrumb-item"><a href="javaScript:void();">गृहपृष्ठ
							</a></li>
							<li class="breadcrumb-item active" aria-current="page">मनपर्ने स्थान</li>
						</ol>
					</div>
				</div>

				<div class="row mb-4">
					<!-- 					<div class="row"> -->
					<div class="col-md-3">
						<div class="header_ul">
							<label>संख्या&nbsp;</label>
							<select id="page-limit-select"
								class="ui_input-field">
								<option value="10">१o</option>
								<option value="25">२५</option>
								<option value="50">५o</option>
								<option value="100">१oo</option>
									<!-- 10 25 50 100 -->
							</select>&nbsp;
						</div>
					</div>

					<div class="col-md-3">
						<div class="header_ul">
							<label>वडा </label>
							<select id="ward-wise-select"
									class="ui_input-field">
								<option value=""></option>
								<option th:value="${indx.index} + 1"
										th:each="option, indx : ${wards}" th:text="${option}"></option>
							</select>

						</div>
					</div>



					<div class="col-md-3">
						<div class="header_ul">
							<label> मनपर्ने स्थान </label> <select
								id="placeType-wise-select" class="ui_input-field">
									<option value=""></option>
									<option th:value="${indx.index} + 1"
										th:each="option, indx : ${placeTypes}" th:text="${option}"></option>
							</select>

						</div>
					</div>


<!--					<div class="col-md-4" sec:authorize="hasAnyRole('CENTRAL_ADMIN', 'WARD_ADMIN')">-->
<!--						<div class="ui">-->
<!--							<label>-->
<!--								Surveyor:&nbsp; <select-->
<!--								id="surveyor-wise-select" class="ui input">-->
<!--									<option value=""></option>-->
<!--									<option th:value="${item.surveyorId}"-->
<!--										th:each="item : ${surveyors}" th:text="${item.fullName}"></option>-->
<!--							</select>-->
<!--							</label>-->
<!--						</div>-->
<!--					</div>-->

					<div class="col-md-3">
						<div class="header_ul">
							<label> खोज</label>
							<span class=>
                                    <input
											type="text" id="search" class="ui_input-field" placeholder="स्थलको नामबाट खोज्नुहोस" />
							</span>

						</div>
					</div>

				</div>

				<table id="myTable" style="display:none">
					<thead>
						<tr>
							<td>स्थान को नाम</td>
							<td>वडा नम्बर</td>
							<td>Place Type</td>
<!-- 							<td>Surveyor</td>
							<td>Actions</td> -->
						</tr>
					</thead>
					<tbody id="replaceHereForWard">
						<tr th:each="favPlace,iteration : ${allFavouritePlaces}">
							<td th:text="${favPlace.placeName}"></td>
							<td th:text="${favPlace.placeWard}"></td>
							<td th:text="${favPlace.placeType}"></td>
							<!-- <td th:text="${favPlace.surveyor}"></td> -->
						</tr>
					</tbody>
				</table>
				<div class="col-lg-12 col-md-12">
					<div class="table-responsive favourite-place-list padding-panel">
<!-- 						<a -->
<!-- 							sec:authorize="hasAnyRole('CENTRAL_ADMIN', 'WARD_ADMIN', 'SURVEYOR')" -->
<!-- 							href="#" th:href="@{/favourite-place/add}" -->
<!-- 							class="btn btn-xs btn-danger">Add Favorite Place</a> -->
						<table th:if="${favouritePlaceList.size() > 0}"
							class="table table-striped table-hover" id="grid">
							<thead>
								<tr>
									<th id="IdNumberColumn"><strong>संख्या.</strong></th>
									<th><strong>स्थान को  नाम</strong></th>
									<th><strong>वडा  नम्बर</strong></th>
<!--									<th><strong>Surveyor</strong>-->
									<th><strong>कार्यहरू</strong></th>
								</tr>
							</thead>

							<tbody id="favourite-place-body">
								<tr class=""
									th:each="favPlace,iteration : ${favouritePlaceList}">
									<td th:text="${iteration.index + 1}"></td>
									<td th:text="${favPlace.placeName}"></td>
									<td th:text="${favPlace.placeWard}"></td>
<!--									<td th:text="${favPlace.surveyor}"></td>-->
									<td>
<!-- 										<a
										sec:authorize="hasAnyRole('CENTRAL_ADMIN', 'WARD_ADMIN', 'SURVEYOR')"
										href="#"
										th:href="@{/favourite-place/edit/} + ${favPlace.filledId}"
										class="btn btn-xs btn-warning">Edit Details</a> -->
										<button sec:authorize="hasAnyRole('CENTRAL_ADMIN', 'WARD_ADMIN', 'SURVEYOR')" th:attr="onclick=|gotoPlaceEditPage('${favPlace.filledId}')|"  class="btn btn-xs btn-warning">संशोधन</button>
										<button
											sec:authorize="hasAnyRole('CENTRAL_ADMIN', 'WARD_ADMIN', 'SURVEYOR')"
											class="btn btn-xs btn-danger deletePlace"
											th:attr="onclick=|deleteFavouritePlace('${favPlace.filledId}')|">
											हटानुस</button> <a
											th:attr="onclick=|gotoPlaceDetailsPage('${favPlace.filledId}')|"
										class="btn btn-xs btn-success">पूर्ण विवरण</a></td>
								</tr>
							</tbody>
<!-- th:href="@{/favourite-place/} + ${favPlace.filledId}" -->
						</table>
						<table
							th:if="${favouritePlaceList == null || #lists.isEmpty(favouritePlaceList)}">
							<thead>
								<tr>
									<td><h2>माफ गर्नुहोला | प्रणालीमा कुनैपनि बिवरण
											भेटीएन|</h2></td>
								</tr>
							</thead>
						</table>
					</div>
				</div>
				<!-- 				</div> -->

				<div class="ui stackable pagination menu pull-right">
					<div class="paginate_button item previous disabled"
						id="grid_previous" href="#" aria-controls="grid" data-dt-idx="0"
						tabindex="0">Previous</div>
					<a class="paginate_button item active" aria-controls="grid"
						data-dt-idx="1" tabindex="0" id="pageNumberPagination">1</a> <a
						class="paginate_button item next" id="grid_next" href="#"
						aria-controls="grid" data-dt-idx="8" tabindex="0">Next</a>
				</div>

			</div>
		</div>
		<a href="javaScript:void();" class="back-to-top"><i
			class="fa fa-angle-double-up"></i> </a>
		<!--Start footer-->
		<footer th:replace="~{fragments/footer :: footer}"></footer>
	</div>
	<div th:replace="~{fragments/scripts :: scripts}"></div>
	<script th:inline="javascript">
		
	/*<![CDATA[*/
	var favPlaceList = /*[[${favouritePlaceList}]]*/'';
	let comeFromGoBack = /*[[${fromGoBack}]]*/'';
	 var userRoles = /*[[${userRoles}]]*/ []; // Assuming userRoles is an array of roles
	/*]]>*/
	

	console.log(userRoles)
	console.log("roles------>>")
	
		//Google transliteration
		google.load("elements", "1", {
		    packages: "transliteration"
		});
	
	
		function onLoad() {
		    var options = {
			        sourceLanguage: 'en',
			        destinationLanguage: ['ne'],
			        shortcutKey: 'ctrl+g',
			        transliterationEnabled: true
			    };
			var control =new google.elements.transliteration.TransliterationControl(options);
			var uniElement = $(".unicode input[type='text'], #grid_filter input");
			control.makeTransliteratable(uniElement);
			control.makeTransliteratable(['search']);
		}; 
			 

		$(window).on("load", function(e) {
			onLoad();
			const buttonFragment = document.getElementById('buttonFragment');
			buttonFragment.style.display = 'block';
			if(getParams(window.location.href).backFrom === "favourite-place-details"){
				console.log("BackFrom res-details ")
				initFuncFetchData();
			}			
		})
			var getParams = function (url) {
			var params = {};
			var parser = document.createElement('a');
			parser.href = url;
			var query = parser.search.substring(1);
			var vars = query.split('&');
			for (var i = 0; i < vars.length; i++) {
				var pair = vars[i].split('=');
				params[pair[0]] = decodeURIComponent(pair[1]);
			}
			return params;
		};

		function initFuncFetchData(){
			var urlObj = getParams(window.location.href);
			let searchKey = urlObj.searchKey;
			let wardNumber = urlObj.wardNo;
			let pageLimit = urlObj.pageSize;
			let placeType = urlObj.placeType;
			let surveyor = urlObj.surveyor;
			let currentPage = urlObj.currentPage ;
			lastPageItemCount = urlObj.lastPageItemCount;
			if(wardNumber){
				$("#ward-wise-select").val(wardNumber);
			} 
			if(placeType){
				$("#placeType-wise-select").val(placeType);
			}
			if(surveyor){
				$("#surveyor-wise-select").val(surveyor);
			}
			if(searchKey){
				$("#search").val(searchKey);
			}
			if(currentPage){
				currentPageNo = parseInt(currentPage);
				document.getElementById("pageNumberPagination").innerHTML = currentPage;
				if(currentPage !== '1')$("#grid_previous").removeClass("disabled");
			} if(pageLimit){
				$("#page-limit-select").val(parseInt(pageLimit));
			}

			if(comeFromGoBack === true){
				let tablesData = "";
				let data = favPlaceList;;
				count = (currentPageNo-1) * pageLimit;
				if(data.length > 0) {
					data.forEach(item => {
						count += 1;
						let buttonsHtml = '';
				if (userRoles.includes('CENTRAL_ADMIN') || userRoles.includes('WARD_ADMIN') || userRoles.includes('SURVEYOR')) {
					buttonsHtml += `<button onclick="gotoPlaceEditPage('${item.filledId}')" class="btn btn-xs btn-warning">संशोधन</button>`;
					buttonsHtml += `<button sec:authorize="hasAnyRole('CENTRAL_ADMIN', 'WARD_ADMIN', 'SURVEYOR')" class="btn btn-xs btn-danger" href="#" onclick="deleteFavouritePlace('${item.filledId}')">हटानुस </button>`;

				}
				buttonsHtml += `<button onclick="gotoPlaceDetailsPage('${item.filledId}')" class="btn btn-xs btn-success">पूर्ण विवरण</button>`;
						tablesData += `<tr><td>${count}</td>
										<td>${item.placeName}</td>
										<td>${item.placeWard}</td>
									
										<td>
											${buttonsHtml}
										</td> </tr>`;
					});
					$("#favourite-place-body").empty();
					$("#favourite-place-body").append(tablesData);
					if(data[pageLimit-1] != null){
					lastItemId = data[pageLimit-1].id;
					}else{
						lastItemId = data[data.length-1].id;
					}
					console.log("LastItemIdUpdated--->"+ lastItemId);
					firstItemId = data[0].id;
					console.log("firstItemUpdated-->"+ firstItemId);
					document.getElementById("pageNumberPagination").innerHTML = currentPageNo;

				}
			}

		}
	
		$(function() {
			var token = $("meta[name='_csrf']").attr("content");
			var header = $("meta[name='_csrf_header']").attr("content");
			$(document).ajaxSend(function(e, xhr, options) {
				xhr.setRequestHeader(header, token);
			});
		});
		// For deleting favPlace
		function deleteFavouritePlace(favPlaceId) {
			swal.fire({
				title : 'Are you sure you want to delete this place?',
				text : "You won't be able to revert this!",
				icon : 'warning',
				showCancelButton : true,
				confirmButtonColor : '#3085d6',
				cancelButtonColor : '#d33',
				confirmButtonText : 'Yes, delete it!'
			}).then((btnClicked) => {
				if(btnClicked.value) {
					$.ajax({
						url : contextPath + "/favourite-place/" + favPlaceId,
						method : "DELETE",
						success : function(data) {
							swal.fire({
								icon : "success",
								text : "The favourite place has been removed"
							}).then((btnClick) => {
								if(btnClick.value) {
									location.reload(true);		
								}
							});
						}
					});
				}
			});
		}
		
		var sortBy = "";
		var sortByOrder = 'DESC';
		var count = 0;
		var currentPageNo = 1;
		
		
		function sortByFunction(sortStr) {
			console.log("OutputtedVal--->" + sortStr);
			sortBy = sortStr;
			sortByOrder = (sortByOrder == 'DESC' ? 'ASC' : 'DESC');
			console.log("sortBy--->" + sortBy);
			console.log("sortByORDER--->" + sortByOrder);
			
		//	document.getElementById('sortedBySpan').innerHTML = sortBy;
			
			$("#grid_previous").addClass("disabled");
<!--			currentPageNo = 1;-->
			let searchKey = $("#search").val();
			let wardNumber = $("#ward-wise-select").val();
			let pageLimit = $("#page-limit-select").val();
			let placeType = $("#placeType-wise-select").val();
			let surveyor = $("#surveyor-wise-select").val();
			console.log("ward-->" + wardNumber);
			let url = contextPath + "/favourite-place/sortBy?";
			if(searchKey != ""){
				url += "searchKey=" + searchKey + "&";
			}
			if(wardNumber != ""){
				url += "wardNo=" + wardNumber + "&";
			}
			if(placeType != "") {
				url += "placeType=" + placeType + "&";
			}
			if(surveyor != "") {
				url += "surveyor=" + surveyor + "&";
			}
			url += "sortBy=" + sortBy + "&";
			url += "sortByOrder=" + sortByOrder + "&";
			url += "pageLimit=" + pageLimit + "&";
			url += "placeType=" + placeType;
			console.log("URL--->" + url);
			let finalUrl = encodeURI(url);
			$("#favourite-place-body").empty();
					$.ajax({
						url : finalUrl,
						method: "GET",
						contentType: "application/json"
					}).done(function(data) {
						let tablesData = "";
						count = 0;

						if(data.length > 0) {
							data.forEach(item => {
								count += 1;
								let buttonsHtml = '';
						if (userRoles.includes('CENTRAL_ADMIN') || userRoles.includes('WARD_ADMIN') || userRoles.includes('SURVEYOR')) {
							buttonsHtml += `<button onclick="gotoPlaceEditPage('${item.filledId}')" class="btn btn-xs btn-warning">संशोधन</button>`;
							buttonsHtml += `<button sec:authorize="hasAnyRole('CENTRAL_ADMIN', 'WARD_ADMIN', 'SURVEYOR')" class="btn btn-xs btn-danger" href="#" onclick="deleteFavouritePlace('${item.filledId}')">हटानुस </button>`;

						}
						buttonsHtml += `<button onclick="gotoPlaceDetailsPage('${item.filledId}')" class="btn btn-xs btn-success">पूर्ण विवरण</button>`;
								tablesData += `<tr><td>${count}</td>
												<td>${item.placeName}</td>
												<td>${item.placeWard}</td>
											
												<td>
													${buttonsHtml}
												</td> </tr>`;
							});
							$("#favourite-place-body").empty();
							$("#favourite-place-body").append(tablesData);
							if(data[pageLimit-1] != null){
							lastItemId = data[pageLimit-1].id;
							}else{
								lastItemId = data[data.length-1].id;
							}
							console.log("LastItemIdUpdated--->"+ lastItemId);
							firstItemId = data[0].id;
							console.log("firstItemUpdated-->"+ firstItemId);
							$("#grid_previous").addClass("disabled");
							$("#grid_next").removeClass("disabled");
							document.getElementById("pageNumberPagination").innerHTML = currentPageNo - 1;
						}else{
							swal.fire({
								text: 'माफ गर्नुहोला | प्रणालीमा कुनैपनि बिवरण भेटीएन!',
								icon: 'warning',
								confirmButtonText: 'OK'
							});
							document.getElementById("pageNumberPagination").innerHTML = currentPageNo + 1;
							$("#grid_next").addClass("disabled");
						}
					});

			
	}
	

	$(function() {
		function fixedEncodeURIComponent(str) {
//				  return encodeURIComponent(str).replace(/[!'()*]/g, function(c) {
			    return '%' + c.charCodeAt(0).toString(16);
			  //});
		}

		// document.getElementById('sortedBySpan').innerHTML = 'None';
		
		 $("#IdNumberColumn").on("click", function(event){
			 location.reload();
		 });
		 

	$("#search").on("keypress", function(event) {
			if(event.which == 13 && event.keyCode == 13) {
				let searchKey = $(this).val();
				let wardNumber = $("#ward-wise-select").val();
				let pageLimit = $("#page-limit-select").val();
				let placeType = $("#placeType-wise-select").val();
				let surveyor = $("#surveyor-wise-select").val();
				console.log("ward-->" + wardNumber);
				currentPageNo = 1;
				let finalUrl = encodeURI(contextPath + "/favourite-place/search" + "?searchKey=" + encodeURIComponent(searchKey) + "&wardNo=" + wardNumber + "&pageSize=" + pageLimit + "&placeType=" + placeType + "&surveyor=" + surveyor);
				if(searchKey === "") {
					swal.fire({
						  text: 'कृपया नाम दिन नभुल्नुहोला!',
						  icon: 'info',
						  confirmButtonText: 'OK'
					});
				} else {
					if(searchKey) {
					$("#favourite-place-body").empty();
						$.ajax({
							url : finalUrl,
							method: "GET",
							contentType: "application/json"
						}).done(function(data) {
							let tablesData = "";
							count = 0;

							if(data.length > 0) {
								data.forEach(item => {
									count += 1;
									let buttonsHtml = '';
						if (userRoles.includes('CENTRAL_ADMIN') || userRoles.includes('WARD_ADMIN') || userRoles.includes('SURVEYOR')) {
							buttonsHtml += `<button onclick="gotoPlaceEditPage('${item.filledId}')" class="btn btn-xs btn-warning">संशोधन</button>`;
							buttonsHtml += `<button sec:authorize="hasAnyRole('CENTRAL_ADMIN', 'WARD_ADMIN', 'SURVEYOR')" class="btn btn-xs btn-danger" href="#" onclick="deleteFavouritePlace('${item.filledId}')">हटानुस </button>`;

						}
						buttonsHtml += `<button onclick="gotoPlaceDetailsPage('${data.filledId}')" class="btn btn-xs btn-success">पूर्ण विवरण</button>`;
									tablesData += `<tr><td>${count}</td>
													<td>${item.placeName}</td>
													<td>${item.placeWard}</td>
													
													<td>
														${buttonsHtml}
													</td> </tr>`;
								});
								$("#favourite-place-body").empty();
								$("#favourite-place-body").append(tablesData);
								lastItemId = data[data.length-1].id;
								console.log("LastItemIdUpdated--->"+ lastItemId);
								firstItemId = data[0].id;
								$("#grid_previous").addClass("disabled");
								$("#grid_next").removeClass("disabled");
								document.getElementById("pageNumberPagination").innerHTML = currentPageNo ;
								
							} else {
								swal.fire({
									  text: 'माफ गर्नुहोला | प्रणालीमा कुनैपनि बिवरण भेटीएन!',
									  icon: 'warning',
									  confirmButtonText: 'OK'
								});
								document.getElementById("pageNumberPagination").innerHTML = currentPageNo ;

							}
						}).fail(function(data) {
							alert(data);
						});
					}
				}
			}
		});
	});
	
	let prevLastItemId = 0;
	var firstItemId = favPlaceList[0].id + "";
    console.log("firstItemId--->" + firstItemId);
    let pageCount = $("#page-limit-select").val();
    var lastItemId = favPlaceList[favPlaceList.length - 1].id + "";
    console.log("FavouritePlaceListSize--->" + favPlaceList.length);
    console.log("LastItemId--->" + lastItemId);
    var currentPageNo = 1;	 
	let lastPageItemCount = "";
	
	$("#ward-wise-select").on("change", function(event) {
			$("#search").val("");
			let wardNumber = $(this).val();
			let pageLimit = $("#page-limit-select").val();
			let placeType = $("#placeType-wise-select").val();
			let surveyor = $("#surveyor-wise-select").val();
			console.log("ward-->" + wardNumber);
			currentPageNo = 1;
			document.getElementById("pageNumberPagination").innerHTML = currentPageNo;
			let appurl = "";
			if(sortBy != ""){
				appurl += "&sortBy=" + sortBy + "&";
				appurl += "sortByOrder=" + sortByOrder;
			}
			let finalUrl = encodeURI(contextPath + "/favourite-place/ward" + "?wardNo=" + wardNumber + "&pageSize=" + pageLimit + "&placeType=" + placeType + "&surveyor=" + surveyor + appurl);
			$("#favourite-place-body").empty();
					$.ajax({
						url : finalUrl,
						method: "GET",
						contentType: "application/json"
					}).done(function(data) {
						let tablesData = "";
						let allWardFavData= "";
						count = 0;

						if(data.data.length > 0) {
							data.data.forEach(item => {
								count += 1;
							let buttonsHtml = '';
						if (userRoles.includes('CENTRAL_ADMIN') || userRoles.includes('WARD_ADMIN') || userRoles.includes('SURVEYOR')) {
							buttonsHtml += `<button onclick="gotoPlaceEditPage('${item.filledId}')" class="btn btn-xs btn-warning">संशोधन</button>`;
							buttonsHtml += `<button sec:authorize="hasAnyRole('CENTRAL_ADMIN', 'WARD_ADMIN', 'SURVEYOR')" class="btn btn-xs btn-danger" href="#" onclick="deleteFavouritePlace('${item.filledId}')">हटानुस </button>`;

						}
						buttonsHtml += `<button onclick="gotoPlaceDetailsPage('${item.filledId}')" class="btn btn-xs btn-success">पूर्ण विवरण</button>`;
								tablesData += `<tr><td>${count}</td>
												<td>${item.placeName}</td>
												<td>${item.placeWard}</td>
											
												<td>
													${buttonsHtml}
												</td> </tr>`;
							});
							data.wardFavPlaces.forEach(item => {
								count += 1;
								allWardFavData += `<tr>
												<td>${item.placeName}</td>
												<td>${item.placeWard}</td>
												<td>${item.placeType}</td></tr>`
												;
							});
							$("#favourite-place-body").empty();
							$("#favourite-place-body").append(tablesData);
							$("#replaceHereForWard").html(allWardFavData);
							let pos = data.data.length - 1;
							let lastData = data.data[pos];
							lastItemId = lastData.id;
							console.log("LastItemIdUpdated--->"+ lastItemId);
							firstItemId = data.data[0].id;
							$("#grid_previous").addClass("disabled");
							$("#grid_next").removeClass("disabled");
							document.getElementById("pageNumberPagination").innerHTML = currentPageNo;
							
							
						}else{
							swal.fire({
								  text: 'माफ गर्नुहोला | प्रणालीमा कुनैपनि बिवरण भेटीएन!',
								  icon: 'warning',
								  confirmButtonText: 'OK'
							});
							document.getElementById("pageNumberPagination").innerHTML = currentPageNo;
						}
					});
	});
	
	
	
	$("#placeType-wise-select").on("change", function(event) {
		$("#search").val("");
		let placeType = $(this).val();
		let wardNumber = $("#ward-wise-select").val();
		let pageLimit = $("#page-limit-select").val();
		let surveyor = $("#surveyor-wise-select").val();
		console.log("placeType-->" + placeType);
		currentPageNo = 1;
		let appurl = "";
		if(sortBy != ""){
			appurl += "&sortBy=" + sortBy + "&";
			appurl += "sortByOrder=" + sortByOrder;
		}
		let finalUrl = encodeURI(contextPath + "/favourite-place/placeType" + "?wardNo=" + wardNumber + "&pageSize=" + pageLimit + "&placeType=" + placeType + "&surveyor=" + surveyor + appurl);
		$("#favourite-place-body").empty();
				$.ajax({
					url : finalUrl,
					method: "GET",
					contentType: "application/json"
				}).done(function(data) {
					let tablesData = "";
					count = 0;
					if(data.length > 0) {
						data.forEach(item => {
							count += 1;
							let buttonsHtml = '';
					if (userRoles.includes('CENTRAL_ADMIN') || userRoles.includes('WARD_ADMIN') || userRoles.includes('SURVEYOR')) {
							buttonsHtml += `<button onclick="gotoPlaceEditPage('${item.filledId}')" class="btn btn-xs btn-warning">संशोधन</button>`;
							buttonsHtml += `<button sec:authorize="hasAnyRole('CENTRAL_ADMIN', 'WARD_ADMIN', 'SURVEYOR')" class="btn btn-xs btn-danger" href="#" onclick="deleteFavouritePlace('${item.filledId}')">हटानुस </button>`;

						}
						buttonsHtml += `<button onclick="gotoPlaceDetailsPage('${item.filledId}')" class="btn btn-xs btn-success">पूर्ण विवरण</button>`;
							tablesData += `<tr><td>${count}</td>
											<td>${item.placeName}</td>
											<td>${item.placeWard}</td>
											
											<td>
												${buttonsHtml}
											</td> </tr>`;
					});
					$("#favourite-place-body").empty();
					$("#favourite-place-body").append(tablesData);
					lastItemId = data[data.length-1].id;
					console.log("LastItemIdUpdated--->"+ lastItemId);
					firstItemId = data[0].id;
					$("#grid_previous").addClass("disabled");
					$("#grid_next").removeClass("disabled");
					document.getElementById("pageNumberPagination").innerHTML = currentPageNo ;
				}else{
				swal.fire({
				  text: 'माफ गर्नुहोला | प्रणालीमा कुनैपनि बिवरण भेटीएन!',
				  icon: 'warning',
				  confirmButtonText: 'OK'
				});
				document.getElementById("pageNumberPagination").innerHTML = currentPageNo;
			}
		});
	});
	
	
	$("#surveyor-wise-select").on("change", function(event) {
		$("#search").val("");
		let surveyor = $(this).val();
		let wardNumber = $("#ward-wise-select").val();
		let pageLimit = $("#page-limit-select").val();
		let placeType = $("#place-wise-select").val();
		console.log("surveyor-->" + surveyor);
		currentPageNo = 1;
		let appurl = "";
		if(sortBy != ""){
			appurl += "&sortBy=" + sortBy + "&";
			appurl += "sortByOrder=" + sortByOrder;
		}
		
		let finalUrl = encodeURI(contextPath + "/favourite-place/surveyor-id" + "?wardNo=" + wardNumber + "&pageSize=" + pageLimit + "&placeType=" + placeType + "&surveyor=" + surveyor + appurl);
		$("#favourite-place-body").empty();
				$.ajax({
					url : finalUrl,
					method: "GET",
					contentType: "application/json"
				}).done(function(data) {
					let tablesData = "";
					count = 0;

					if(data.length > 0) {
						data.forEach(item => {
							count += 1;
							let buttonsHtml = '';
					if (userRoles.includes('CENTRAL_ADMIN') || userRoles.includes('WARD_ADMIN') || userRoles.includes('SURVEYOR')) {
							buttonsHtml += `<button onclick="gotoPlaceEditPage('${item.filledId}')" class="btn btn-xs btn-warning">संशोधन</button>`;
							buttonsHtml += `<button sec:authorize="hasAnyRole('CENTRAL_ADMIN', 'WARD_ADMIN', 'SURVEYOR')" class="btn btn-xs btn-danger" href="#" onclick="deleteFavouritePlace('${item.filledId}')">हटानुस </button>`;

						}
						buttonsHtml += `<button onclick="gotoPlaceDetailsPage('${item.filledId}')" class="btn btn-xs btn-success">पूर्ण विवरण</button>`;
							tablesData += `<tr><td>${count}</td>
											<td>${item.placeName}</td>
											<td>${item.placeWard}</td>
											
											<td>
												${buttonsHtml}
											</td> </tr>`;
					});
					$("#favourite-place-body").empty();
					$("#favourite-place-body").append(tablesData);
					lastItemId = data[data.length-1].id;
					console.log("LastItemIdUpdated--->"+ lastItemId);
					firstItemId = data[0].id;
					$("#grid_previous").addClass("disabled");
					$("#grid_next").removeClass("disabled");
					document.getElementById("pageNumberPagination").innerHTML = currentPageNo ;
				
				}else{
				swal.fire({
				  text: 'माफ गर्नुहोला | प्रणालीमा कुनैपनि बिवरण भेटीएन!',
				  icon: 'warning',
				  confirmButtonText: 'OK'
				});
				document.getElementById("pageNumberPagination").innerHTML = currentPageNo;
			}
		});
	});
	
	
	$("#page-limit-select").on("change", function(event) {
		let pageLimit = $(this).val();
		let wardNumber = $("#ward-wise-select").val();
		let searchKey = $("#search").val();
		let placeType = $("#placeType-wise-select").val();
		let surveyor = $("#surveyor-wise-select").val();
		console.log("ward-->" + wardNumber);
		currentPageNo = 1;
		let appurl = "";
		if(sortBy != ""){
			appurl += "&sortBy=" + sortBy + "&";
			appurl += "sortByOrder=" + sortByOrder;
		}
		
		let finalUrl = encodeURI(contextPath + "/favourite-place/pageLimit" + "?wardNo=" + wardNumber + "&pageSize=" + pageLimit + "&placeType=" + placeType + "&surveyor=" + surveyor + "&searchKey=" + searchKey + "&lastSeenId=" + firstItemId + appurl);
		$("#favourite-place-body").empty();
				$.ajax({
					url : finalUrl,
					method: "GET",
					contentType: "application/json"
				}).done(function(data) {
<!--					alert(JSON.stringify(data));-->
					let tablesData = "";
					count = 0;
					if(data.length > 0) {
						data.forEach(item => {
							count += 1;
												let buttonsHtml = '';
					if (userRoles.includes('CENTRAL_ADMIN') || userRoles.includes('WARD_ADMIN') || userRoles.includes('SURVEYOR')) {
							buttonsHtml += `<button onclick="gotoPlaceEditPage('${item.filledId}')" class="btn btn-xs btn-warning">संशोधन</button>`;
							buttonsHtml += `<button sec:authorize="hasAnyRole('CENTRAL_ADMIN', 'WARD_ADMIN', 'SURVEYOR')" class="btn btn-xs btn-danger" href="#" onclick="deleteFavouritePlace('${item.filledId}')">हटानुस </button>`;

						}
						buttonsHtml += `<button onclick="gotoPlaceDetailsPage('${item.filledId}')" class="btn btn-xs btn-success">पूर्ण विवरण</button>`;
								tablesData += `<tr><td>${count}</td>
											<td>${item.placeName}</td>
											<td>${item.placeWard}</td>
											
											<td>
												${buttonsHtml}
											</td> </tr>`;
						});
						$("#favourite-place-body").empty();
						$("#favourite-place-body").append(tablesData);
						let pos = data.length - 1;
						let dataLast = data[pos];
						lastItemId = dataLast.id;
						console.log("LastItemIdUpdated--->"+ lastItemId);
						firstItemId = data[0].id;
						document.getElementById("pageNumberPagination").innerHTML = currentPageNo
					} else {
						swal.fire({
								text: 'माफ गर्नुहोला | प्रणालीमा कुनैपनि बिवरण भेटीएन!',
								icon: 'warning',
								confirmButtonText: 'OK'
							});
							document.getElementById("pageNumberPagination").innerHTML = parseInt(currentPageNo);
							$("#grid_next").addClass("disabled");
					}
				});
	});
	


	
	$("#grid_next").on("click", function(event) {
			$("#grid_previous").removeClass("disabled");
			let searchKey = $("#search").val();
			let wardNumber = $("#ward-wise-select").val();
			let pageLimit = $("#page-limit-select").val();
			let placeType = $("#placeType-wise-select").val();
			let surveyor = $("#surveyor-wise-select").val();
			console.log("ward-->" + wardNumber);
			//currentPageNo ++;
			console.log("CurrentPageNo--->" + currentPageNo);
			
			let url = contextPath + "/favourite-place/nextLot?";
			if(searchKey != ""){
				url += "searchKey=" + searchKey + "&";
			}
			if(wardNumber != ""){
				url += "wardNo=" + wardNumber + "&";
			}
			if(placeType != "") {
				url += "placeType=" + placeType + "&";
			}
			if(surveyor != "") {
				url += "surveyor=" + surveyor + "&";
			}
			
			url += "lastSeenId=" + lastItemId + "&";
			url += "action=next"+ "&";
			
			if(sortBy != ""){
				url += "sortBy=" + sortBy + "&";
				url += "sortByOrder=" + sortByOrder + "&";
			}
			url += "currentPage=" + currentPageNo + "&";
			url += "pageLimit=" + pageLimit;
			console.log("URL--->" + url);
			let finalUrl = encodeURI(url);
					$.ajax({
						url : finalUrl,
						method: "GET",
						contentType: "application/json"
					}).done(function(data) {
						console.log(data);
						let tablesData = "";
						count = currentPageNo * pageLimit;
						if(data.length > 0) {
							data.forEach(item => {
								count += 1;
																let buttonsHtml = '';
								if (userRoles.includes('CENTRAL_ADMIN') || userRoles.includes('WARD_ADMIN') || userRoles.includes('SURVEYOR')) {
							buttonsHtml += `<button onclick="gotoPlaceEditPage('${item.filledId}')" class="btn btn-xs btn-warning">संशोधन</button>`;
							buttonsHtml += `<button sec:authorize="hasAnyRole('CENTRAL_ADMIN', 'WARD_ADMIN', 'SURVEYOR')" class="btn btn-xs btn-danger" href="#" onclick="deleteFavouritePlace('${item.filledId}')">हटानुस </button>`;

						}
						buttonsHtml += `<button onclick="gotoPlaceDetailsPage('${item.filledId}')" class="btn btn-xs btn-success">पूर्ण विवरण</button>`;
								tablesData += `<tr><td>${count}</td>
												<td>${item.placeName}</td>
												<td>${item.placeWard}</td>
												
												<td>
													${buttonsHtml}
												</td> </tr>`;
							});
							$("#favourite-place-body").empty();
							$("#favourite-place-body").append(tablesData);
							// for last page"
							if(data.length < pageLimit){
								lastPageItemCount = data.length
							}
							if(data[pageLimit-1] != null){
							lastItemId = data[pageLimit-1].id;
							}else{
								lastItemId = data[data.length-1].id;
							}
							console.log("LastItemIdUpdated--->"+ lastItemId);
							firstItemId = data[0].id;
							console.log("firstItemUpdated-->"+ firstItemId);
							document.getElementById("pageNumberPagination").innerHTML = parseInt(currentPageNo) + 1;
							currentPageNo = parseInt(currentPageNo) + 1;

						}else{
							swal.fire({
								text: 'माफ गर्नुहोला | प्रणालीमा कुनैपनि बिवरण भेटीएन!',
								icon: 'warning',
								confirmButtonText: 'OK'
							});
							// document.getElementById("pageNumberPagination").innerHTML = parseInt(currentPageNo) + 1;
							$("#grid_next").addClass("disabled");
							//currentPageNo --;
						}
					});
});


	$("#grid_previous").on("click", function(event) {
			$("#grid_next").removeClass("disabled");
			let searchKey = $("#search").val();
			let wardNumber = $("#ward-wise-select").val();
			let pageLimit = $("#page-limit-select").val();
			let placeType = $("#placeType-wise-select").val();
			let surveyor = $("#surveyor-wise-select").val();
			console.log("ward-->" + wardNumber);
			//currentPageNo --;
			console.log("CurrentPageNo--->" + currentPageNo);
			
			let url = contextPath + "/favourite-place/nextLot?";
			if(searchKey != ""){
				url += "searchKey=" + searchKey + "&";
			}
			if(wardNumber != ""){
				url += "wardNo=" + wardNumber + "&";
			}
			if(placeType != "") {
				url += "placeType=" + placeType + "&";
			}
			if(surveyor != "") {
				url += "surveyor=" + surveyor + "&";
			}
			
			url += "lastSeenId=" + firstItemId + "&";
			url += "action=prev"+ "&";
			
			if(sortBy != ""){
				url += "sortBy=" + sortBy + "&";
				url += "sortByOrder=" + sortByOrder + "&";
			}
			url += "currentPage=" + currentPageNo + "&";
			
			url += "pageLimit=" + pageLimit;
			console.log("URL--->" + url);
			let finalUrl = encodeURI(url);
					$.ajax({
						url : finalUrl,
						method: "GET",
						contentType: "application/json"
					}).done(function(data) {
						let tablesData = "";
						count = (currentPageNo-1) * pageLimit - (pageLimit);
						if(data.length > 0) {
							data.forEach(item => {
								count += 1;
							let buttonsHtml = '';
						if (userRoles.includes('CENTRAL_ADMIN') || userRoles.includes('WARD_ADMIN') || userRoles.includes('SURVEYOR')) {
							buttonsHtml += `<button onclick="gotoPlaceEditPage('${item.filledId}')" class="btn btn-xs btn-warning">संशोधन</button>`;
							buttonsHtml += `<button sec:authorize="hasAnyRole('CENTRAL_ADMIN', 'WARD_ADMIN', 'SURVEYOR')" class="btn btn-xs btn-danger" href="#" onclick="deleteFavouritePlace('${item.filledId}')">हटानुस </button>`;

						}
						buttonsHtml += `<button onclick="gotoPlaceDetailsPage('${item.filledId}')" class="btn btn-xs btn-success">पूर्ण विवरण</button>`;
								tablesData += `<tr><td>${count}</td>
												<td>${item.placeName}</td>
												<td>${item.placeWard}</td>
												
												<td>
													${buttonsHtml}
												</td> </tr>`;
							});
							$("#favourite-place-body").empty();
							$("#favourite-place-body").html(tablesData);
							firstItemId = data[0].id;
							console.log("firstItemIdUpdated--->"+ firstItemId);
							lastItemId = data[data.length-1].id;
							document.getElementById("pageNumberPagination").innerHTML = currentPageNo - 1;
							currentPageNo = currentPageNo -1;
														lastPageItemCount = "";

						}else{
							swal.fire({
								text: 'माफ गर्नुहोला | प्रणालीमा कुनैपनि बिवरण भेटीएन!',
								icon: 'warning',
								confirmButtonText: 'OK'
							});
							// document.getElementById("pageNumberPagination").innerHTML = (currentPageNo) + 1;
							$("#grid_previous").addClass("disabled");
							//currentPageNo ++;
						}
					});
			});	
		
	</script>

	<script th:inline="javascript">
		function gotoPlaceDetailsPage(favouritePlaceId){
		console.log('Clicked on the ahref', favouritePlaceId);
		
					let searchKey = $("#search").val();
					let wardNumber = $("#ward-wise-select").val();
					let pageLimit = $("#page-limit-select").val();
					let placeType = $("#placeType-wise-select").val();
					let surveyor = $("#surveyor-wise-select").val();

					//currentPageNo;
					
					let url = contextPath + "/favourite-place/" + favouritePlaceId + "?parentHTML=favourite-place-data&";
					
					if(searchKey != ""){
						url += "searchKey=" + searchKey + "&";
					}
					if(wardNumber != ""){
						url += "wardNo=" + wardNumber + "&";
					}
					if(placeType !=""){
						url += "placeType=" + placeType + "&";
					}
					if(surveyor != ""){
						url += "surveyor=" + surveyor + "&";
					}
					//  url += "prevLastItemId=" + prevLastItemId + "&";
					
					// if(sortBy != ""){
					// 	url += "sortBy=" + sortBy + "&";
					// 	url += "sortByOrder=" + sortByOrder + "&";
					// }
					url += "lastSeenId=" + lastItemId + "&";
					url += "action=next"+ "&";

					url += "currentPage=" + currentPageNo + "&";
					url += "pageSize=" + pageLimit + "&";
					url += "lastPageItemCount="+lastPageItemCount;
					lastPageItemCount = "";
		
		
		 window.location.href = url;
		}

		function gotoPlaceEditPage(favouritePlaceId){
		console.log('Clicked on the ahref', favouritePlaceId);
		
					let searchKey = $("#search").val();
					let wardNumber = $("#ward-wise-select").val();
					let pageLimit = $("#page-limit-select").val();
					let placeType = $("#placeType-wise-select").val();
					let surveyor = $("#surveyor-wise-select").val();

					//currentPageNo;
					
					let url = contextPath + "/favourite-place/edit/" + favouritePlaceId + "?parentHTML=favourite-place-data&";
					
					if(searchKey != ""){
						url += "searchKey=" + searchKey + "&";
					}
					if(wardNumber != ""){
						url += "wardNo=" + wardNumber + "&";
					}
					if(placeType !=""){
						url += "placeType=" + placeType + "&";
					}
					if(surveyor != ""){
						url += "surveyor=" + surveyor + "&";
					}
					// url += "prevLastItemId=" + prevLastItemId + "&";
					
					// if(sortBy != ""){
					// 	url += "sortBy=" + sortBy + "&";
					// 	url += "sortByOrder=" + sortByOrder + "&";
					// }
					
					// url += "currentPage=" + currentPageNo + "&";
					url += "lastSeenId=" + lastItemId + "&";
					url += "action=next"+ "&";

					url += "currentPage=" + currentPageNo + "&";
					url += "pageSize=" + pageLimit + "&";
					url += "lastPageItemCount="+lastPageItemCount;
					lastPageItemCount = "";
		
		
		 window.location.href = url;
		}
	</script>


	  <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
  <script>
    function convertToExcel(elementId, fileName) {
      const htmlContent = document.getElementById(elementId)?.outerHTML;

      if (htmlContent) {
        const workbook = XLSX.utils.book_new();
        const worksheet = XLSX.utils.table_to_sheet(document.getElementById(elementId));

        XLSX.utils.book_append_sheet(workbook, worksheet, 'Sheet1');
        const excelBuffer = writeExcelBuffer(workbook);

        saveAsExcelFile(excelBuffer, `${fileName}.xlsx`);
      }
    }

    function writeExcelBuffer(workbook) {
      const excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
      return excelBuffer;
    }

    function saveAsExcelFile(buffer, fileName) {
      const data = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });

      if (typeof navigator !== 'undefined' && navigator.msSaveBlob) {
        navigator.msSaveBlob(data, fileName);
      } else {
        const link = document.createElement('a');
        const url = URL.createObjectURL(data);

        link.href = url;
        link.setAttribute('download', fileName);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }
    }
  </script>
</body>
</html>